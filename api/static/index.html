<html>
<head>
	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<link href="https://unpkg.com/vue-simple-notify/dist/vue-simple-notify.min.css" rel="stylesheet">
	<script src="https://unpkg.com/vue-simple-notify/dist/vue-simple-notify.min.js"></script>
	<style>
		main {
			display : grid;
			grid-template-columns: 1fr 1fr;
			grid-template-areas: "chat alert";
		}

		section.chat {
			grid-area: chat;
		}

		section.alerts{
			grid-area: alerts;
		}
	</style>
</head>
<body> Testing </body>

<main id ="v-app">
	<section class = "alerts">
		<alerts-component :items="alerts"></alerts-component>
	</section>


	<section class="chat">





<h1>TESTER</h1>
<form>
	<input v-model="text" type="text"/>
	<button type="submit" @click.prevent="sendChatMessage()">send</button>
</form>
<p>
	<li v-for="msg of messages">
		<strong> {{ msg.sender }} : </strong>  {{ msg.message }}
	</li>
</p>
</section>
</main>
<script>
	Vue.component('alerts-component', VueSimpleNotify.VueSimpleNotify)
	var app = new Vue(
		{
			el: "#v-app", // va donner l'Ã­d
			data : {
				username : "",
				text: "",
				messages: [],
				socket: { chat: null, alerts: null },
				alerts: []
			},
			methods : {
				sendChatMessage() {
					console.log("send " + this.text); // this.text = the payload
					this.socket.chat.emit('chatToServer', { sender : this.username , message : this.text } );
					this.text = "";
				},
				receiveChatMessage(msg) {
					console.log("recv " + msg);
					this.messages.push(msg); // adding a message to chat
				},
				receiveAlertMessage(msg) {
					console.log("recv " + msg);
					this.alerts.push(msg); // adding an alert
				}
			},
			created : function() { // creatin hok
					this.username = prompt("Enter your name : ");
					this.socket.chat = io('http://localhost:3000/chat'); // namespace
					this.socket.alert = io('http://localhost:3000/alert'); // namespace
					this.socket.chat.on('chatToClient', (msg) => {
					this.receiveChatMessage(msg);
				}) // listener
				this.socket.alert.on('alertToClient', (msg) => {
					this.receiveAlertMessage(msg);
				} // listener
				)
			}
		});

</script>
</html>

